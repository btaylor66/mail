# =============================================================================
# Gmail Email Processor - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to git - it contains sensitive credentials
# =============================================================================

# -----------------------------------------------------------------------------
# Gmail OAuth 2.0 Configuration
# -----------------------------------------------------------------------------
# Get these from Google Cloud Console:
# https://console.cloud.google.com/apis/credentials
# See GMAIL_AUTH.md for detailed setup instructions

GMAIL_CLIENT_ID=your-client-id.apps.googleusercontent.com
GMAIL_CLIENT_SECRET=GOCSPX-your-client-secret-here
GMAIL_REDIRECT_URI=http://localhost:8000/auth/callback

# Gmail API Scopes (comma-separated)
# For read-only access (recommended):
GMAIL_SCOPES=https://www.googleapis.com/auth/gmail.readonly,https://www.googleapis.com/auth/userinfo.email

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# PostgreSQL connection string
# Format: postgresql://[user]:[password]@[host]:[port]/[database]

# For Docker Compose (default)
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/gmail_processor

# For local development (uncomment if not using Docker)
# DATABASE_URL=postgresql://localhost:5432/gmail_processor

# Database pool settings
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# Redis connection string for queue and cache

# For Docker Compose (default)
REDIS_URL=redis://redis:6379/0

# For local development (uncomment if not using Docker)
# REDIS_URL=redis://localhost:6379/0

# Redis connection settings
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
# Task queue settings

CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Worker settings
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_TASK_ACKS_LATE=true
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Task timeouts (in seconds)
CELERY_TASK_SOFT_TIME_LIMIT=300
CELERY_TASK_TIME_LIMIT=360

# -----------------------------------------------------------------------------
# Application Configuration
# -----------------------------------------------------------------------------

# Email fetching settings
DEFAULT_DAYS_LOOKBACK=30
MAX_EMAILS_PER_FETCH=500
BATCH_SIZE=50

# Event extraction settings
ENABLE_MEETING_EXTRACTION=true
ENABLE_DATE_EXTRACTION=true
ENABLE_EVENT_EXTRACTION=true
MIN_CONFIDENCE_SCORE=0.7

# API server settings
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=1

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------

# Flask secret key for session management
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-here-change-this

# Fernet encryption key for OAuth token storage
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
TOKEN_ENCRYPTION_KEY=your-fernet-key-here-change-this

# CORS settings (for production, restrict to your domain)
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/app/logs/app.log
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=5

# Enable detailed SQL logging (development only)
SQL_ECHO=false

# Structured logging
ENABLE_STRUCTURED_LOGGING=true

# -----------------------------------------------------------------------------
# Environment
# -----------------------------------------------------------------------------

ENVIRONMENT=development
DEBUG=false

# -----------------------------------------------------------------------------
# Monitoring and Observability
# -----------------------------------------------------------------------------

# Flower (Celery monitoring dashboard)
FLOWER_PORT=5555
FLOWER_BASIC_AUTH=admin:changethispassword

# Sentry (error tracking) - optional
# SENTRY_DSN=https://your-sentry-dsn-here

# -----------------------------------------------------------------------------
# Email Processing Configuration
# -----------------------------------------------------------------------------

# Text extraction settings
MAX_EMAIL_SIZE_MB=25
PROCESS_ATTACHMENTS=true
ALLOWED_ATTACHMENT_TYPES=.ics,.eml,.msg,.pdf

# NLP model for event extraction
# Download with: python -m spacy download en_core_web_sm
SPACY_MODEL=en_core_web_sm

# Date parsing settings
DATE_PARSER_LANGUAGES=en
DATE_PARSER_SETTINGS={"PREFER_DATES_FROM": "future"}

# -----------------------------------------------------------------------------
# Rate Limiting and Retry Configuration
# -----------------------------------------------------------------------------

# Gmail API rate limiting
GMAIL_API_REQUESTS_PER_SECOND=25
GMAIL_API_REQUESTS_PER_DAY=250000

# Retry settings
MAX_RETRIES=3
RETRY_BACKOFF_FACTOR=2
RETRY_BACKOFF_MAX=300

# -----------------------------------------------------------------------------
# Testing Configuration (for pytest)
# -----------------------------------------------------------------------------

# Override for test environment
# TEST_DATABASE_URL=postgresql://localhost:5432/gmail_processor_test
# TEST_REDIS_URL=redis://localhost:6379/1

# -----------------------------------------------------------------------------
# Optional: Multi-User Configuration
# -----------------------------------------------------------------------------

# Enable multi-user mode (future feature)
ENABLE_MULTI_USER=false
REQUIRE_API_KEY=false

# -----------------------------------------------------------------------------
# Data Retention
# -----------------------------------------------------------------------------

# Days to keep processed emails
EMAIL_RETENTION_DAYS=365

# Days to keep processing logs
LOG_RETENTION_DAYS=90

# Enable automatic cleanup
ENABLE_AUTOMATIC_CLEANUP=true
